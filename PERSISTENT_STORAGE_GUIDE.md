# ЁЯТ╛ р╕Др╕╣р╣Ир╕бр╕╖р╕нр╕Бр╕▓р╕гр╣Ар╕Бр╣Зр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕Ър╕Ър╕Цр╕▓р╕зр╕гр╕кр╕│р╕лр╕гр╕▒р╕Ъ RAG PDF

## ЁЯУЛ р╕кр╕Цр╕▓р╕Щр╕░р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ

тЬЕ **ChromaDB Persistent Storage р╕Чр╕│р╕Зр╕▓р╕Щр╣Бр╕ер╣Йр╕з!**

- **Database Type**: ChromaDB (SQLite backend)
- **Storage Location**: `./data/chromadb/`
- **Current Records**: 291 records
- **Storage Size**: ~4MB
- **Persistence**: тЬЕ р╕Цр╕▓р╕зр╕г (р╣Др╕бр╣Ир╕лр╕▓р╕вр╣Ар╕бр╕╖р╣Ир╕н restart)

## ЁЯФз р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Database р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ

### 1. **PersistentClient Configuration**
```python
# р╣Гр╕Кр╣Й PersistentClient р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Ар╕Бр╣Зр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Цр╕▓р╕зр╕г
chroma_client = chromadb.PersistentClient(
    path="./data/chromadb",
    settings=Settings(
        anonymized_telemetry=False,
        allow_reset=False,
        is_persistent=True
    )
)
```

### 2. **Collection Management**
```python
# р╣Вр╕лр╕ер╕Ф collection р╕Чр╕╡р╣Ир╕бр╕╡р╕нр╕вр╕╣р╣Ир╣Бр╕ер╣Йр╕з р╣Др╕бр╣Ир╕кр╕гр╣Йр╕▓р╕Зр╣Гр╕лр╕бр╣Ир╕Чр╕╕р╕Бр╕Др╕гр╕▒р╣Йр╕З
try:
    collection = chroma_client.get_collection(name="pdf_data")
    logging.info(f"Loaded existing collection: {collection.count()} records")
except:
    collection = chroma_client.create_collection(name="pdf_data")
```

### 3. **р╕кр╕│р╕Др╕▒р╕Н: р╣Др╕бр╣Ир╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Бр╣Ир╕▓**
```python
# р╣Бр╕Бр╣Йр╣Др╕Вр╣Бр╕ер╣Йр╕з - р╣Др╕бр╣Ир╣Ар╕гр╕╡р╕вр╕Б clear_vector_db() р╕Чр╕╕р╕Бр╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣Ир╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Ф PDF
# р╕Хр╕нр╕Щр╕Щр╕╡р╣Йр╣Ар╕Юр╕┤р╣Ир╕бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Вр╣Йр╕▓р╣Др╕Ыр╣Гр╕Щ database р╣Ар╕Фр╕┤р╕бр╣Бр╕Чр╕Щ
if current_count > 0:
    logging.info("Adding new PDF to existing database")
    # р╣Ар╕Юр╕┤р╣Ир╕бр╕Вр╣Йр╕нр╕бр╕╣р╕е р╣Др╕бр╣Ир╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Бр╣Ир╕▓
else:
    logging.info("Creating new database")
```

## ЁЯУБ р╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╣Др╕Яр╕ер╣М

```
data/
тФЬтФАтФА chromadb/                    # Database р╕лр╕ер╕▒р╕Б (persistent)
тФВ   тФЬтФАтФА chroma.sqlite3          # SQLite database file
тФВ   тФФтФАтФА [collection-ids]/       # Collection data folders
тФЬтФАтФА chromadb_backup/            # Automatic backups
тФВ   тФЬтФАтФА backup_20241030_143000/
тФВ   тФФтФАтФА backup_20241030_150000/
тФФтФАтФА images/                    # PDF images
```

## ЁЯФД р╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕гр╕░р╕Ър╕Ъ

### тЬЕ **р╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Ф PDF р╕Др╕гр╕▒р╣Йр╕Зр╣Бр╕гр╕Б**
1. р╕кр╕гр╣Йр╕▓р╕З collection р╣Гр╕лр╕бр╣И (р╕Цр╣Йр╕▓р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡)
2. р╣Бр╕вр╕Бр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕ер╕░р╕гр╕╣р╕Ыр╕ар╕▓р╕Юр╕Ир╕▓р╕Б PDF
3. р╕кр╕гр╣Йр╕▓р╕З embeddings р╣Бр╕ер╕░р╣Ар╕Бр╣Зр╕Ър╣Гр╕Щ ChromaDB
4. р╕кр╕│р╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤

### тЬЕ **р╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Ф PDF р╕Др╕гр╕▒р╣Йр╕Зр╕Хр╣Ир╕нр╣Др╕Ы**
1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╕бр╕╡р╕нр╕вр╕╣р╣И (р╣Др╕бр╣Ир╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Бр╣Ир╕▓!)
2. р╕кр╕│р╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ
3. р╣Ар╕Юр╕┤р╣Ир╕б PDF р╣Гр╕лр╕бр╣Ир╣Ар╕Вр╣Йр╕▓р╣Др╕Ыр╣Гр╕Щ database р╣Ар╕Фр╕┤р╕б
4. р╕кр╕│р╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕нр╕╡р╕Бр╕Др╕гр╕▒р╣Йр╕З

### тЬЕ **Restart р╣Вр╕Ыр╕гр╣Бр╕Бр╕гр╕б**
1. р╣Вр╕лр╕ер╕Ф ChromaDB р╕Ир╕▓р╕Б disk
2. р╕Фр╕╢р╕З collection "pdf_data" р╕Чр╕╡р╣Ир╕бр╕╡р╕нр╕вр╕╣р╣И
3. р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╕вр╕▒р╕Зр╕Др╕Зр╕нр╕вр╕╣р╣И тЬЕ

## ЁЯЫая╕П р╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕бр╕╖р╕нр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╣Гр╕Щ UI

### 1. **р╕кр╣Ир╕зр╕Щр╕Ир╕▒р╕Фр╕Бр╕▓р╕г Database**
- **р╕кр╕│р╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е**: р╕кр╕│р╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕Ър╕Ъ manual
- **р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е Database**: р╕Фр╕╣р╕кр╕Цр╕▓р╕Щр╕░р╣Бр╕ер╕░р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕▒р╣Ир╕зр╣Др╕Ы
- **р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф**: р╕Фр╕╣р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕ар╕▓р╕вр╣Гр╕Щ database

### 2. **р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╣Бр╕кр╕Фр╕З**
```
{
  "total_records": 291,
  "database_path": "./data/chromadb",
  "database_exists": true,
  "sqlite_exists": true,
  "database_size_mb": 3.87,
  "backup_count": 2,
  "collections": ["pdf_data"]
}
```

## ЁЯЪи р╕Ыр╕▒р╕Нр╕лр╕▓р╕Чр╕╡р╣Ир╣Бр╕Бр╣Йр╣Др╕Вр╣Бр╕ер╣Йр╕з

### тЭМ **р╕Ыр╕▒р╕Нр╕лр╕▓р╣Ар╕Бр╣Ир╕▓: р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕лр╕▓р╕вр╣Ар╕бр╕╖р╣Ир╕н restart**
- **р╕кр╕▓р╣Ар╕лр╕Хр╕╕**: `clear_vector_db()` р╕Цр╕╣р╕Бр╣Ар╕гр╕╡р╕вр╕Бр╕Чр╕╕р╕Бр╕Др╕гр╕▒р╣Йр╕Зр╕Чр╕╡р╣Ир╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Ф PDF
- **р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й**: р╣Бр╕Бр╣Йр╣Др╕В `process_pdf_upload()` р╣Др╕бр╣Ир╣Гр╕лр╣Йр╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Бр╣Ир╕▓

### тЭМ **р╕Ыр╕▒р╕Нр╕лр╕▓р╣Ар╕Бр╣Ир╕▓: Database р╕Цр╕╣р╕Б reset р╕Ър╣Ир╕нр╕в**
- **р╕кр╕▓р╣Ар╕лр╕Хр╕╕**: р╕кр╕гр╣Йр╕▓р╕З collection р╣Гр╕лр╕бр╣Ир╕Чр╕╕р╕Бр╕Др╕гр╕▒р╣Йр╕З
- **р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й**: р╣Вр╕лр╕ер╕Ф collection р╕Чр╕╡р╣Ир╕бр╕╡р╕нр╕вр╕╣р╣Ир╕Бр╣Ир╕нр╕Щ

### тЬЕ **р╕кр╕Цр╕▓р╕Щр╕░р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ: р╕Чр╕│р╕Зр╕▓р╕Щр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З**
- Database р╕Цр╕▓р╕зр╕гр╕Фр╣Йр╕зр╕в ChromaDB
- р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕бр╣Ир╕лр╕▓р╕вр╣Ар╕бр╕╖р╣Ир╕н restart
- р╣Ар╕Юр╕┤р╣Ир╕б PDF р╣Гр╕лр╕бр╣Ир╣Вр╕Фр╕вр╣Др╕бр╣Ир╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Бр╣Ир╕▓
- р╕бр╕╡р╕гр╕░р╕Ър╕Ъ backup р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤

## ЁЯФН р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Чр╕│р╕Зр╕▓р╕Щр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З

### 1. **р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Гр╕Щ terminal**
```bash
python -c "
import chromadb
client = chromadb.PersistentClient('./data/chromadb')
collection = client.get_collection('pdf_data')
print(f'Records: {collection.count()}')
"
```

### 2. **р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Др╕Яр╕ер╣М**
```bash
ls -la data/chromadb/
# р╕Др╕зр╕гр╣Ар╕лр╣Зр╕Щ chroma.sqlite3 р╣Бр╕ер╕░ folder collections
```

### 3. **р╕Чр╕Фр╕кр╕нр╕Ъ restart**
1. р╕гр╕▒р╕Щр╣Вр╕Ыр╕гр╣Бр╕Бр╕гр╕бр╣Бр╕ер╕░р╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Ф PDF
2. р╕Ыр╕┤р╕Фр╣Вр╕Ыр╕гр╣Бр╕Бр╕гр╕б
3. р╕гр╕▒р╕Щр╣Вр╕Ыр╕гр╣Бр╕Бр╕гр╕бр╣Гр╕лр╕бр╣И
4. р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Др╕зр╕гр╕вр╕▒р╕Зр╕нр╕вр╕╣р╣И тЬЕ

## ЁЯТб р╣Ар╕Др╕ер╣Зр╕Фр╕ер╕▒р╕Ър╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ

### тЬЕ **р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕Ыр╕гр╕░р╕кр╕┤р╕Чр╕Шр╕┤р╕ар╕▓р╕Ю**
- Database р╕Чр╕│р╕Зр╕▓р╕Щр╣Ар╕гр╣Зр╕зр╣Бр╕бр╣Йр╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ир╕│р╕Щр╕зр╕Щр╕бр╕▓р╕Б
- р╣Др╕бр╣Ир╕Ир╕│р╣Ар╕Ыр╣Зр╕Щр╕Хр╣Йр╕нр╕З cleanup р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ър╣Ир╕нр╕в
- Backup р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤р╕Кр╣Ир╕зр╕вр╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╕Бр╕▓р╕гр╕кр╕╣р╕Нр╕лр╕▓р╕в

### тЬЕ **р╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Вр╣Йр╕нр╕бр╕╣р╕е**
- р╕Цр╣Йр╕▓р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕ер╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е: р╕Бр╕Фр╕Ыр╕╕р╣Ир╕б "р╕ер╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е" р╣Гр╕Щ UI
- р╕Цр╣Йр╕▓р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕г backup: р╕Бр╕Фр╕Ыр╕╕р╣Ир╕б "р╕кр╕│р╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е"
- р╕Цр╣Йр╕▓р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕г restore: р╣Гр╕Кр╣Йр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ `restore_vector_db()`

### тЬЕ **Monitoring**
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ log р╕кр╕│р╕лр╕гр╕▒р╕Ъ database operations
- р╣Гр╕Кр╣Йр╕Ыр╕╕р╣Ир╕б "р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф" р╣Ар╕Юр╕╖р╣Ир╕нр╕Фр╕╣р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕ар╕▓р╕вр╣Гр╕Щ
- Monitor р╕Вр╕Щр╕▓р╕Ф database р╕Ьр╣Ир╕▓р╕Щ UI

## ЁЯОп р╕кр╕гр╕╕р╕Ы

**р╕гр╕░р╕Ър╕Ър╣Ар╕Бр╣Зр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕Ър╕Ър╕Цр╕▓р╕зр╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╣Бр╕ер╣Йр╕з!**

- тЬЕ ChromaDB Persistent Storage
- тЬЕ р╣Др╕бр╣Ир╕ер╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Бр╣Ир╕▓р╣Ар╕бр╕╖р╣Ир╕нр╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Ф PDF р╣Гр╕лр╕бр╣И
- тЬЕ р╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕бр╣Ир╕лр╕▓р╕вр╣Ар╕бр╕╖р╣Ир╕н restart р╣Вр╕Ыр╕гр╣Бр╕Бр╕гр╕б
- тЬЕ р╕бр╕╡р╕гр╕░р╕Ър╕Ъ backup р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
- тЬЕ UI р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╣Бр╕ер╕░р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е

**р╕Ыр╕▒р╕Нр╕лр╕▓р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕лр╕▓р╕вр╕Цр╕╣р╕Бр╣Бр╕Бр╣Йр╣Др╕Вр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з!** ЁЯЪА